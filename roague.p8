pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- basis
function _init()
 t=0
	dx={-1,1,0,0}
	dy={0,0,-1,1}
	 
 _upd=upd_gme
 _drw=drw_gme
 
 str_gme()
end

function _update60()
 t+=1
 _upd()
end

function _draw()
 _drw()
end

function str_gme()
 int_p()
end
-->8
-- updates
function upd_gme()
 for i=0,3 do
  if btnp(i) then
   p_mov(i)
   return
  end
 end
end

function upd_mov()
 p.t=min(p.t+0.1,1)
 p.mov()
 
 if p.t==1 then
 	_upd=upd_gme
 end
end

-->8
-- draws
frm_sp=8

function drw_gme()
 cls(0)
 map()
 drw_ani(p.ani,p.x*8+p.ox,p.y*8+p.oy,p.flp)
end

function get_frm(ani)
 return ani[1+flr(t/frm_sp)%#ani]
end

function drw_spr(_spr,_x,_y,_flp)
 palt(0,false)
 spr(_spr,_x,_y,1,1,_flp,false)
 palt(0,true)
end

function drw_ani(_ani,_x,_y,_flp)
 drw_spr(get_frm(_ani),_x,_y,_flp)
end
-->8
--player
function int_p()
	p={
	 x=7,
	 y=2,
	 flp=true,
	 ani={1,2,3,4},
	 t=0,
	 ox=0,
	 oy=0,
	 iox=0,
	 ioy=0,
	 mov=nil,
	}
end

function p_mov_walk()
 p.ox=p.iox*(1-p.t)
 p.oy=p.ioy*(1-p.t)
end

function p_mov_bump()
 local tme=p.t
 if tme>0.5 then
  tme=1-p.t
 end
 p.ox=p.iox*(tme)
 p.oy=p.ioy*(tme)
end

function p_mov(i)
	local dx,dy=dx[i+1],dy[i+1]
	local dsx,dsy=p.x+dx,p.y+dy
	local tle=mget(dsx,dsy)
	
	p.iox,p.ioy=-dx*8,-dy*8
	p.ox,p.oy=p.iox,p.ioy
	
	if fget(tle,0) then
	 p.iox,p.ioy=dx*8,dy*8
 	p.ox,p.oy=0,0
	 p.mov=p_mov_bump
	 interact(tle,dsx,dsy)
	else
	 p.mov=p_mov_walk
 	p.x=dsx
	 p.y=dsy
	end
	
	p.flp=(dy!=0 and p.flp) or dx>0
	p.t=0
	_upd=upd_mov
end
-->8
--env
function interact(tle,dsx,dsy)
 if tle==20 or tle==22 then
  mset(dsx,dsy,tle+1)
 end
end
__gfx__
00000000077777000000000007777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000707077700077777070707770077777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777707700707077777770770707077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000077700777707700007770777707700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000077770000077700000777000077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700700000770700000707000007700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777770777777707777777777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777000077777000777770077777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77077070007000000000007077777770077777000777770007777700000000000000000000000000000000000000000000000000000000000000000000000000
00000000700000000007707000000000700000707000007070000070000000000777777000000000000000000000000000000000000000000000000000000000
70770770000000707707707077000000707770707070007070777070007770000700007000000000000000000000000000000000000000000000000000000000
00000000000000007707700077077000707770707070007077707770777077700700007000000000000000000000000000000000000000000000000000000000
77077070000700007700007077077070707700707070007070707070707070700777777000000000000000000000000000000000000000000000000000000000
00000000000000000007777077077070707770707070007070070070700700700000000000000000000000000000000000000000000000000000000000000000
70770770000007007777777077077070707770707070007077777770777777700070070000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000007777000007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07707700077077000770770077007700007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77070070777700707777707000007700007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77000070777700707777707000077000007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000700077707000777770000770000007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000007770000077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00070000000700000007000000770000007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777770777777707777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000070707700707077707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000070707700707077707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000070707700707077707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000070707700707077707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000700070007000700070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777000007770000077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000001000303030003000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010101010101015101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010111111111011111110111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010111111111010111110111611100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010111111111111111110111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010111014101010101010101014100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010111011111111101111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010111010101011101110101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010111111101111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010111111101111111110101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010111111101111111110111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010111111101111111110111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010101014101010101010101011100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010101010101013101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
