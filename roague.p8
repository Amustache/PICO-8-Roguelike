pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- basis
function _init()
 t=0
 _upd=upd_gme
 _drw=drw_gme
 str_gme()
end

function _update60()
 t+=1
 _upd()
end

function _draw()
 _drw()
end

function str_gme()
 int_p()
end
-->8
-- updates
function upd_gme()
 for i=0,3 do
  if btnp(i) then
   mov_p(i)
  return
  end
 end
end

function upd_mov()
 p.t=min(p.t+0.1,1)
 p.ox=p.iox*(1-p.t)
 p.oy=p.ioy*(1-p.t)
 if p.t==1 then
 	_upd=upd_gme
 end
end

-->8
-- draws
frm_sp=8

function drw_gme()
 cls(0)
 map()
 drw_ani(p.ani,p.x*8+p.ox,p.y*8+p.oy,p.flp)
end

function get_frm(ani)
 return ani[1+flr(t/frm_sp)%#ani]
end

function drw_spr(_spr,_x,_y,_flp)
 palt(0,false)
 spr(_spr,_x,_y,1,1,_flp,false)
 palt(0,true)
end

function drw_ani(_ani,_x,_y,_flp)
 drw_spr(get_frm(_ani),_x,_y,_flp)
end
-->8
--player
function int_p()
	p={x=2,
	 y=5,
	 flp=true,
	 ani={1,2,3,4},
	 t=0,
	 ox=0,
	 oy=0,
	 iox=0,
	 ioy=0,
	 dx={-1,1,0,0},
	 dy={0,0,-1,1},}
end

function mov_p(i)
	local dx,dy=p.dx[i+1],p.dy[i+1]
	local dsx,dsy=p.x+dx,p.y+dy
	local wal=fget(mget(dsx,dsy),0)
	
	if wal then
	 return
	end
	
	p.x=dsx
	p.y=dsy
	p.iox,p.ioy=-dx*8,-dy*8
	p.ox,p.oy=p.iox,p.ioy
	p.t=0
	p.flp=(dy!=0 and p.flp) or dx>0
	_upd=upd_mov
end
__gfx__
00000000077777000000000007777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000707077700077777070707770077777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777707700707077777770770707077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000077700777707700007770777707700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000077770000077700000777000077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700700000770700000707000007700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777770777777707777777777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777000077777000777770077777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77077070007000000000007077777770077777000777770000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000700000000007707000000000700000707000007000000000000000000000000000000000000000000000000000000000000000000000000000000000
70770770000000707707707077000000707770707070007000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000007707700077077000707770707070007000000000000000000000000000000000000000000000000000000000000000000000000000000000
77077070000700007700007077077070707700707070007000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000007777077077070707770707070007000000000000000000000000000000000000000000000000000000000000000000000000000000000
70770770000007007777777077077070707770707070007000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0020201010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0020201010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0020201010101111111113101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010101011111111111110101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010141111111111111110101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
